kind: Task
apiVersion: tekton.dev/v1beta1
metadata:
  name: home-assistant
  namespace: devops
spec:
  description: >-
    This task does a configuration check of the Home Assistant yaml files.
  workspaces:
    - name: home-assistant-code
      description: A workspace that contains the fetched git repository.
  params:
    - name: containerImage
      type: string
      default: "homeassistant/home-assistant:latest"
    - name: args
      type: array
      description: extra args needs to append
      default: ["--help"]
  steps:
    # Add an extra step to list the contents of /workspace
    # You might add this before or after another Task
    - name: dump-directory
      image: alpine
      command:
        - /bin/sh
      args:
        - "-c"
        - |
          set -ex
          ls -la
          find /workspace
    - name: rename-example-secret
      image: "$(params.containerImage)"
      workingDir: $(workspaces.home-assistant-code.path)
      command:
        - mv ./src/config/secrets.yaml.example ./src/config/secrets.yaml
    - name: config-check
      image: "$(params.containerImage)"
      workingDir: $(workspaces.home-assistant-code.path)
      command:
        - hass
      args:
        - $(params.args)
